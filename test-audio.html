<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Autoplay Audio (with Safe Fallback)</title>
  <style>
    :root { --hint-bg: rgba(0,0,0,.6); --hint-fg: #fff; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display: grid; place-items: center;
      background: #0f172a; color: #e5e7eb;
    }
    .wrap { text-align: center; }
    h1 { font-size: 1.25rem; margin: .25rem 0 .5rem; }
    p { margin: 0; opacity: .8; }

    /* The little “enable sound” chip */
    .hint {
      position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
      background: var(--hint-bg); color: var(--hint-fg);
      padding: 10px 14px; border-radius: 999px;
      display: flex; gap: 10px; align-items: center;
      user-select: none; -webkit-user-select: none;
      backdrop-filter: blur(6px);
      transition: opacity .25s ease, visibility .25s ease;
      cursor: pointer;
    }
    .hint.hidden { opacity: 0; visibility: hidden; }
    .hint button {
      all: unset;
      padding: 6px 10px; border-radius: 999px;
      background: #22c55e; color: #052e16; font-weight: 600;
    }
    .hint .dot { width: 8px; height: 8px; border-radius: 50%; background: #22c55e; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,1px,1px); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Audio will start automatically</h1>
    <p>(If your browser blocks it, tap/click once to enable sound.)</p>
  </div>

  <!-- Your audio -->
  <audio id="bgAudio"
         src="bound.mp3"
         preload="auto"
         loop
         playsinline
         webkit-playsinline
         muted
  ></audio>

  <!-- Enable-sound hint -->
  <div id="hint" class="hint" role="button" tabindex="0" aria-label="Enable sound">
    <span class="dot" aria-hidden="true"></span>
    <span>Tap to enable sound</span>
    <button id="enableBtn" type="button" aria-describedby="hint-desc">Enable</button>
    <span id="hint-desc" class="sr-only">Press to unmute audio</span>
  </div>

  <script>
    (function () {
      const audio = document.getElementById('bgAudio');
      const hint  = document.getElementById('hint');
      const enableBtn = document.getElementById('enableBtn');

      if (!audio) return;

      // Try to autoplay silently on load
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          audio.volume = 0;     // start silent
          audio.muted  = true;  // required for autoplay
          await audio.play();   // most browsers allow muted autoplay
          // If autoplay succeeded, keep hint visible until user interacts (we’ll unmute then)
        } catch (err) {
          // Autoplay blocked even while muted (rare). We’ll rely on the gesture fallback below.
          // console.debug('Muted autoplay blocked:', err?.name || err);
        }
      });

      let soundEnabled = false;

      async function enableSound() {
        if (soundEnabled) return;
        soundEnabled = true;

        try {
          // Ensure audio is at least playing (some browsers require play() AFTER gesture)
          if (audio.paused) await audio.play();

          audio.muted = false;

          // Fade in volume over ~1.5s
          let v = 0;
          const step = 0.05;     // 20 steps
          const iv = setInterval(() => {
            v = Math.min(1, v + step);
            audio.volume = v;
            if (v >= 1) clearInterval(iv);
          }, 75);

          // Hide the hint
          hint.classList.add('hidden');
        } catch (err) {
          // If something still fails, re-show hint so the user can try again
          soundEnabled = false;
          hint.classList.remove('hidden');
          // console.debug('Enable sound failed:', err?.name || err);
        }
      }

      // First user gesture anywhere enables sound
      const firstGesture = () => { enableSound(); window.removeEventListener('pointerdown', firstGesture); };
      window.addEventListener('pointerdown', firstGesture, { once: true });

      // Also wire the visible controls
      enableBtn.addEventListener('click', enableSound);
      hint.addEventListener('click', enableSound);
      hint.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); enableSound(); }
      });

      // Optional: if the page becomes visible again, ensure audio is playing
      document.addEventListener('visibilitychange', async () => {
        if (document.visibilityState === 'visible' && !audio.paused) {
          try { await audio.play(); } catch (_) {}
        }
      });
    })();
  </script>
</body>
</html>
